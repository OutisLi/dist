<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2024.02.28-2.5 FIR Filter</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9f84806b.css" as="style"><link rel="preload" href="/assets/js/app.aca65f08.js" as="script"><link rel="preload" href="/assets/js/2.0c4bddf9.js" as="script"><link rel="preload" href="/assets/js/1.50b457b8.js" as="script"><link rel="preload" href="/assets/js/36.39948275.js" as="script"><link rel="prefetch" href="/assets/js/10.325b9f09.js"><link rel="prefetch" href="/assets/js/11.845e3692.js"><link rel="prefetch" href="/assets/js/12.ecdb524b.js"><link rel="prefetch" href="/assets/js/13.3f3f6a36.js"><link rel="prefetch" href="/assets/js/14.eb7a3d07.js"><link rel="prefetch" href="/assets/js/15.b60f3925.js"><link rel="prefetch" href="/assets/js/16.85253907.js"><link rel="prefetch" href="/assets/js/17.c2838453.js"><link rel="prefetch" href="/assets/js/18.3256f17f.js"><link rel="prefetch" href="/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/assets/js/20.10e47ab9.js"><link rel="prefetch" href="/assets/js/21.33b300c9.js"><link rel="prefetch" href="/assets/js/22.62284270.js"><link rel="prefetch" href="/assets/js/23.7db5debe.js"><link rel="prefetch" href="/assets/js/24.c7d90f40.js"><link rel="prefetch" href="/assets/js/25.6eea5c7e.js"><link rel="prefetch" href="/assets/js/26.9050baa1.js"><link rel="prefetch" href="/assets/js/27.580760bf.js"><link rel="prefetch" href="/assets/js/28.de97261b.js"><link rel="prefetch" href="/assets/js/29.6c399461.js"><link rel="prefetch" href="/assets/js/3.af33e5d6.js"><link rel="prefetch" href="/assets/js/30.0d308e4d.js"><link rel="prefetch" href="/assets/js/31.e3d87865.js"><link rel="prefetch" href="/assets/js/32.06d47597.js"><link rel="prefetch" href="/assets/js/33.b2f53157.js"><link rel="prefetch" href="/assets/js/34.b56caa5e.js"><link rel="prefetch" href="/assets/js/35.3ddbf166.js"><link rel="prefetch" href="/assets/js/37.0d9f8801.js"><link rel="prefetch" href="/assets/js/38.fb00ff7f.js"><link rel="prefetch" href="/assets/js/39.336735c7.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.89589368.js"><link rel="prefetch" href="/assets/js/41.f8b893e2.js"><link rel="prefetch" href="/assets/js/42.02e366b2.js"><link rel="prefetch" href="/assets/js/43.04786f37.js"><link rel="prefetch" href="/assets/js/44.33f8b3ae.js"><link rel="prefetch" href="/assets/js/45.acb58579.js"><link rel="prefetch" href="/assets/js/46.26b94de1.js"><link rel="prefetch" href="/assets/js/47.0e4b18e7.js"><link rel="prefetch" href="/assets/js/48.21e56b0a.js"><link rel="prefetch" href="/assets/js/49.28eb16aa.js"><link rel="prefetch" href="/assets/js/5.7098d77a.js"><link rel="prefetch" href="/assets/js/50.7bec212f.js"><link rel="prefetch" href="/assets/js/51.b5f5758a.js"><link rel="prefetch" href="/assets/js/52.72a43db2.js"><link rel="prefetch" href="/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/assets/js/7.6a854e57.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.77260563.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f84806b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/good.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          二叉树
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">
  Installation
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li><li class="dropdown-item"><h4>
          滑动窗口
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">
  Installation
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Chip" class="dropdown-title"><span class="title">Chip</span> <span class="arrow down"></span></button> <button type="button" aria-label="Chip" class="mobile-dropdown-title"><span class="title">Chip</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          一生一芯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Chip/Chip/一生一芯计划.html" class="nav-link">
  预学习
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  B阶段
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  A阶段
</a></li></ul></li><li class="dropdown-item"><h4>
          Chisel
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Chip/Chip/2024.02.21-Chisel.html" class="nav-link">
  Bootcamp
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li><li class="dropdown-item"><h4>
          Verilog
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Chip/Chip/2023.11.07-Verilog语法.html" class="nav-link">
  Basic
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="LeetCode" class="dropdown-title"><span class="title">LeetCode</span> <span class="arrow down"></span></button> <button type="button" aria-label="LeetCode" class="mobile-dropdown-title"><span class="title">LeetCode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          二叉树
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">
  Installation
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li><li class="dropdown-item"><h4>
          滑动窗口
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/language/chinese/" class="nav-link">
  Installation
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Chip" class="dropdown-title"><span class="title">Chip</span> <span class="arrow down"></span></button> <button type="button" aria-label="Chip" class="mobile-dropdown-title"><span class="title">Chip</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          一生一芯
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Chip/Chip/一生一芯计划.html" class="nav-link">
  预学习
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  B阶段
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  A阶段
</a></li></ul></li><li class="dropdown-item"><h4>
          Chisel
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Chip/Chip/2024.02.21-Chisel.html" class="nav-link">
  Bootcamp
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li><li class="dropdown-item"><h4>
          Verilog
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Chip/Chip/2023.11.07-Verilog语法.html" class="nav-link">
  Basic
</a></li><li class="dropdown-subitem"><a href="/language/japanese/" class="nav-link">
  xxx
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>2024 02 21 Chisel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.21-1 Introduction to Scala.html" class="sidebar-link">2024.02.21-1. Introduction to Scala</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.23-2.1 First Chisel Module.html" class="sidebar-link">2024.02.23-2.1 First Chisel Module</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.24-2.2 Combinational Logic.html" class="sidebar-link">2024.02.24-2.2 Combinational Logic</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.25-2.3 Control Flow.html" class="sidebar-link">2024.02.25-2.3 Control Flow</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.26-2.4 Sequential Logic.html" class="sidebar-link">2024.02.26-2.4 Sequential Logic</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.28-2.5 FIR Filter.html" class="active sidebar-link">2024.02.28-2.5 FIR Filter</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.28-2.5 FIR Filter.html#fir-filter-generator" class="sidebar-link">FIR Filter Generator</a></li></ul></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.29-2.6 More on ChiselTest.html" class="sidebar-link">2024.02.29-2.6 More on ChiselTest</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.03.01-3.1 Generators Parameters.html" class="sidebar-link">2024.03.01-3.1 Generators: Parameters</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.03.03-3.2 Generators Collections.html" class="sidebar-link">2024.03.03-3.2 Generators: Collections</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.03.04-3.3 Interlude Chisel Standard Library.html" class="sidebar-link">2024.03.04-3.3 Interlude: Chisel Standard Library</a></li><li><a href="/Chip/Chip/2024.02.21-Chisel/2024.03.05-3.4 Higher-Order Functions.html" class="sidebar-link">2024.03.05-3.4 Higher-Order Functions</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2024-02-28-2-5-fir-filter"><a href="#_2024-02-28-2-5-fir-filter" class="header-anchor">#</a> 2024.02.28-2.5 FIR Filter</h1> <p><img src="2024%2002%2028-2%205%20FIR%20Filter%20ff2c573494664f2b81ff4c6f2e21bf80/Untitled.jpeg" alt="Untitled"></p> <p>$$
y[n] = b_0 x[n] + b_1 x[n-1] + b_2 x[n-2] + ...
$$</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">class</span> My4ElementFir<span class="token punctuation">(</span>b0<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> b1<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> b2<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> b3<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Module <span class="token punctuation">{</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">{</span>
    <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">val</span> reg_1 <span class="token operator">=</span> RegInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg_2 <span class="token operator">=</span> RegInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> reg_3 <span class="token operator">=</span> RegInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
  
  reg_1 <span class="token operator">:</span><span class="token operator">=</span> io<span class="token punctuation">.</span>in
  reg_2 <span class="token operator">:</span><span class="token operator">=</span> reg_1
  reg_3 <span class="token operator">:</span><span class="token operator">=</span> reg_2

	<span class="token comment">// 或者使用RegNext来一并定义初始化及赋值</span>
	<span class="token keyword">val</span> reg_1 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in<span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">)</span>
	<span class="token keyword">val</span> reg_2 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>reg_1<span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">)</span>
	<span class="token keyword">val</span> reg_3 <span class="token operator">=</span> RegNext<span class="token punctuation">(</span>reg_2<span class="token punctuation">,</span> <span class="token number">0.</span>U<span class="token punctuation">)</span>
  
  io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> b0<span class="token punctuation">.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span> <span class="token operator">*</span> io<span class="token punctuation">.</span>in <span class="token operator">+</span> b1<span class="token punctuation">.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span> <span class="token operator">*</span> reg_1 <span class="token operator">+</span> b2<span class="token punctuation">.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span> <span class="token operator">*</span> reg_2 <span class="token operator">+</span> b3<span class="token punctuation">.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span> <span class="token operator">*</span> reg_3
<span class="token punctuation">}</span>
</code></pre></div><h2 id="fir-filter-generator"><a href="#fir-filter-generator" class="header-anchor">#</a> <strong>FIR Filter Generator</strong></h2> <p>一个有限脉冲响应（FIR）滤波器生成器。生成器的**<code>length</code><strong>参数决定了滤波器的抽头数目，即滤波器的长度。这个生成器有三个输入：</strong><code>in</code><strong>（滤波器的输入信号）、</strong><code>valid</code><strong>（一个布尔值，表示输入是否有效）和</strong><code>consts</code><strong>（一个向量，包含所有抽头的系数）。还有一个输出</strong><code>out</code>**，即滤波器的输出。</p> <ul><li>**<code>taps</code>**是一个序列，包含输入和一系列寄存器，用于实现滤波器的延迟线。</li> <li>当**<code>valid</code>**信号为真时，序列中的每个元素（除了第一个）被更新为前一个元素的值。</li> <li>输出**<code>out</code>**是抽头值和对应系数乘积之和。</li></ul> <p>这个结构允许滤波器动态处理不同长度的输入，通过改变**<code>consts</code>**向量的内容来改变滤波器的特性。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">class</span> MyManyDynamicElementVecFir<span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Module <span class="token punctuation">{</span>
  <span class="token keyword">val</span> io <span class="token operator">=</span> IO<span class="token punctuation">(</span><span class="token keyword">new</span> Bundle <span class="token punctuation">{</span>
    <span class="token keyword">val</span> in <span class="token operator">=</span> Input<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> valid <span class="token operator">=</span> Input<span class="token punctuation">(</span>Bool<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> out <span class="token operator">=</span> Output<span class="token punctuation">(</span>UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> consts <span class="token operator">=</span> Input<span class="token punctuation">(</span>Vec<span class="token punctuation">(</span>length<span class="token punctuation">,</span> UInt<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token comment">// Such concision! You'll learn what all this means later.</span>
  <span class="token keyword">val</span> taps <span class="token operator">=</span> Seq<span class="token punctuation">(</span>io<span class="token punctuation">.</span>in<span class="token punctuation">)</span> <span class="token operator">++</span> Seq<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>io<span class="token punctuation">.</span>consts<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>RegInit<span class="token punctuation">(</span><span class="token number">0.</span>U<span class="token punctuation">(</span><span class="token number">8.</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  taps<span class="token punctuation">.</span>zip<span class="token punctuation">(</span>taps<span class="token punctuation">.</span>tail<span class="token punctuation">)</span><span class="token punctuation">.</span>foreach <span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> when <span class="token punctuation">(</span>io<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span> b <span class="token operator">:</span><span class="token operator">=</span> a <span class="token punctuation">}</span> <span class="token punctuation">}</span>

  io<span class="token punctuation">.</span>out <span class="token operator">:</span><span class="token operator">=</span> taps<span class="token punctuation">.</span>zip<span class="token punctuation">(</span>io<span class="token punctuation">.</span>consts<span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> a <span class="token operator">*</span> b <span class="token punctuation">}</span><span class="token punctuation">.</span>reduce<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

visualize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token keyword">new</span> MyManyDynamicElementVecFir<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><p><strong><code>val io = IO(new Bundle {...})</code><strong>定义了模块的接口，包括8位宽的输入</strong><code>in</code></strong>，一个有效信号**<code>valid</code><strong>，8位宽输出</strong><code>out</code><strong>，和长度为</strong><code>length</code><strong>的系数向量</strong><code>consts</code>**。</p></li> <li><p>**<code>val taps = Seq(io.in) ++ Seq.fill(io.consts.length - 1)(RegInit(0.U(8.W)))</code><strong>这行代码在FIR滤波器实现中创建了一个名为</strong><code>taps</code><strong>的序列，用于存储当前和之前的输入值，从而实现数据的时间序列延迟。首先，它将输入信号</strong><code>io.in</code><strong>作为序列的第一个元素。随后，使用</strong><code>++</code><strong>操作符将</strong><code>io.in</code><strong>与一个新的序列连接起来，后者通过</strong><code>Seq.fill(io.consts.length - 1)(RegInit(0.U(8.W)))</code><strong>创建，其中包含</strong><code>length - 1</code><strong>个初始化为0的8位寄存器。这样，</strong><code>taps</code><strong>序列就包含了一个输入信号和</strong><code>length - 1</code><strong>个延迟寄存器，总共</strong><code>length</code><strong>个元素，每个元素对应滤波器的一个抽头。在Chisel中，虽然</strong><code>io.in</code><strong>不是寄存器，但</strong><code>taps</code><strong>序列可以包含不同类型的元素，因为在Chisel里，所有这些都被视为</strong><code>Data</code><strong>类型的子类，可以被综合为硬件。在这个上下文中，</strong><code>io.in</code>**是直接的输入信号，而后续元素是寄存器类型，但它们共同构成了一个序列，用于表示滤波器的不同时间点上的信号值。这种混合类型的序列是可行的，并可以在Chisel生成的硬件中正确表达相应的逻辑。</p></li> <li><p>**<code>taps.zip(taps.tail).foreach { case (a, b) =&gt; when (io.valid) { b := a } }</code><strong>在输入</strong><code>valid</code><strong>为真时，将</strong><code>taps</code>**序列中每个元素的值传递到下一个元素，实现数据在寄存器间的移动。</p> <p><strong><code>zip</code><strong>是一个方法，它将两个集合中对应位置的元素组成一对，生成一个新的集合。在这里，</strong><code>taps.zip(taps.tail)</code><strong>的作用是将</strong><code>taps</code><strong>列表中的每个元素与其后面的元素配对。</strong><code>tail</code><strong>是一个方法，返回除第一个元素外的列表所有元素。例如，如果</strong><code>taps</code><strong>是</strong><code>[in, reg1, reg2, reg3]</code></strong>，那么**<code>taps.tail</code><strong>就是</strong><code>[reg1, reg2, reg3]</code><strong>。</strong><code>taps.zip(taps.tail)</code><strong>的结果将是</strong><code>[(in, reg1), (reg1, reg2), (reg2, reg3)]</code><strong>。这样，</strong><code>foreach</code><strong>就可以遍历这些配对，根据</strong><code>valid</code>**信号更新寄存器的值，实现数据的逐级传递。</p> <p><strong><code>case (a, b) =&gt;</code><strong>是模式匹配的语法，用于解构元组，将</strong><code>zip</code><strong>操作生成的元素对分别赋值给</strong><code>a</code></strong>（当前元素）和**<code>b</code>**（下一个元素）。</p></li> <li><p><strong><code>io.out := taps.zip(io.consts).map { case (a, b) =&gt; a * b }.reduce(_ + _)</code><strong>计算输出</strong><code>out</code></strong>，即将每个延迟元素与其对应的系数相乘，并将所有乘积求和得到最终结果。</p> <p>在这段代码中，**<code>map</code><strong>和</strong><code>reduce</code>**是Scala中的集合操作方法：</p> <ul><li><strong><code>map</code></strong>：对集合中的每个元素应用一个函数。这里**<code>map { case (a, b) =&gt; a * b }</code><strong>对每对</strong><code>(a, b)</code><strong>应用乘法操作，</strong><code>a</code><strong>来自</strong><code>taps</code><strong>，</strong><code>b</code><strong>来自</strong><code>io.consts</code>**，分别代表寄存器中的数据和滤波器的系数。</li> <li><strong><code>reduce</code></strong>：对集合中的元素应用一个二元操作，逐步将集合减少为单一结果。这里的**<code>reduce(_ + _)</code>**将所有乘法结果相加，得到最终的滤波输出。</li></ul> <p>不使用**<code>foreach</code><strong>是因为</strong><code>foreach</code><strong>仅用于执行操作而不返回结果，而这里的目的是计算经过滤波器后的输出值，需要通过</strong><code>map</code><strong>和</strong><code>reduce</code>**聚合计算结果。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Chip/Chip/2024.02.21-Chisel/2024.02.26-2.4 Sequential Logic.html" class="prev">
        2024.02.26-2.4 Sequential Logic
      </a></span> <span class="next"><a href="/Chip/Chip/2024.02.21-Chisel/2024.02.29-2.6 More on ChiselTest.html">
        2024.02.29-2.6 More on ChiselTest
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.aca65f08.js" defer></script><script src="/assets/js/2.0c4bddf9.js" defer></script><script src="/assets/js/1.50b457b8.js" defer></script><script src="/assets/js/36.39948275.js" defer></script>
  </body>
</html>
